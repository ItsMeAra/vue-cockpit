!function(t,n){"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?exports.vueCockpit=n():t.vueCockpit=n()}(this,function(){return function(t){function n(e){if(i[e])return i[e].exports;var o=i[e]={exports:{},id:e,loaded:!1};return t[e].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}var i={};return n.m=t,n.c=i,n.p="",n(0)}([function(t,n){var i=function(t){var n={cockpitUrl:t.cockpitUrl,apiKey:t.apiKey,selector:t.selector,basePath:location.pathname.slice(0,-1),collections:{},regions:{},collectionsLoaded:!1,regionsLoaded:!1,thumbnailWidth:t.thumbnailWidth?t.thumbnailWidth:1920,thumbnailQuality:t.thumbnailQuality?t.thumbnailQuality:70},i=document.cookie.length>0,e=window.location.search.indexOf("hint")>=0,o=e?"Hide hints":"Show hints";if(i&&$("body").append('<button id="toggleSegmentHints" class="" style="position: fixed; top: 0; right: 0; z-index: 999999; background-color: #555; color: #fff; cursor: pointer; border: 0; font-family: Sans-Serif; font-size: 14px; padding: 10px 15px;">'+o+"</button>"),$("#toggleSegmentHints").click(function(){var t=window.location.href.split("#")[0];e?window.location.href=t.replace("?hints",""):window.location.href=t+"?hints"}),e>0){var c=function(t,n,i,e){0==t.parents(".has-binding").length&&(t.css("outline","1px dashed red").css("cursor","pointer"),t.attr("entity-type",n),t.attr("entity-name",i),t.attr("title",n+" > "+i+(e&&e.indexOf(" ")==-1?" > "+e:"")),t.addClass("has-binding"))};$(':not(:has(div)):contains("{{")').each(function(){var t=$(this),n=t.text();if(n.indexOf("regions.")>0||n.indexOf("collections.")>0){var i=n.trim().replace("{{","").replace("}}","").split("."),e=i[0],o=i[1],a=i[2];c(t,e,o,a)}}),$("[v-for]").each(function(){var t=$(this),n=t.attr("v-for"),i=n.indexOf(" in ")>0?"in":"of",e=n.split(" "+i+" ")[1].split(".")[0],o=n.split(".")[1],a=n.split(".")[2];c(t,e,o,a)}),$("[v-html]").each(function(){var t=$(this),n=t.attr("v-html"),i=n.split("."),e=i[0],o=i[1],a=i[2];c(t,e,o,a)}),$("[v-bind\\:href]").each(function(){var t=$(this),n=t.attr("v-bind:href"),i=n.split("."),e="regions",o=i[1],a=i[2];c(t,e,o,a)}),$("[v-bind\\:src]").each(function(){var t=$(this),n=t.attr("v-bind:src"),i=n.split("."),e="regions",o=i[1],a=i[2];c(t,e,o,a)}),$("body").on("click",".has-binding",function(t){var i=$(this),e=i.attr("entity-type"),o=i.attr("entity-name"),c="regions"==e?"form":"entries",a=n.cockpitUrl+"/"+e+"/"+c+"/"+o;window.open(a)})}fetch(n.cockpitUrl+"/api/collections/listCollections?token="+n.apiKey).then(function(t){return t.json()}).then(function(i){n.collectionNames=i,i.forEach(function(t){n.collections[t]=[]}),fetch(n.cockpitUrl+"/api/regions/listRegions?token="+n.apiKey).then(function(t){return t.json()}).then(function(i){n.regionNames=i,i.forEach(function(t){n.regions[t]=[]}),new Vue({el:n.selector,data:n,created:function(){this.fetchAllCollectionEntries(),this.fetchAllRegionEntries()},methods:{fetchAllRegionEntries:function(){var t=this;this.regionNames.forEach(function(n,i,e){var o=i==e.length-1;t.fetchRegionEntries(n,o)})},fetchRegionEntries:function(i,e){var o=this;fetch(n.cockpitUrl+"/api/regions/data/"+i+"?token="+this.apiKey).then(function(t){return t.json()}).then(function(n){o.regions[i]=n,o.regionsLoaded=o.regionsLoaded||e,o.regionsLoaded&&o.collectionsLoaded&&t.callback&&t.callback()})["catch"](function(t){console.log("parsing failed",t)})},fetchAllCollectionEntries:function(){var t=this;this.collectionNames.forEach(function(n,i,e){var o=i==e.length-1;t.fetchCollectionEntries(n,o)})},fetchCollectionEntries:function(i,e){var o=this;fetch(n.cockpitUrl+"/api/collections/get/"+i+"?token="+this.apiKey).then(function(t){return t.json()}).then(function(c){c.entries.forEach(function(t){Object.keys(t).forEach(function(i){t[i].path&&fetch(n.cockpitUrl+"/api/cockpit/image?token="+o.apiKey,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({src:t[i].path,m:"resize",w:n.thumbnailWidth,q:n.thumbnailQuality})}).then(function(t){return t.text()}).then(function(n){t[i].thumbnailPath=n})["catch"](function(t){console.log("parsing failed",t)})})}),o.collections[i]=c.entries,o.collectionsLoaded=o.collectionsLoaded||e,o.regionsLoaded&&o.collectionsLoaded&&t.callback&&t.callback()})["catch"](function(t){console.log("parsing failed",t)})}}})})})["catch"](function(t){console.log("parsing failed",t)})};t.exports={init:i}}])});
//# sourceMappingURL=vue-cockpit.min.js.map