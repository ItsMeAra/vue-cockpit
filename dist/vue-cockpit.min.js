!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.vueCockpit=e():t.vueCockpit=e()}(this,function(){return function(t){function e(i){if(o[i])return o[i].exports;var n=o[i]={exports:{},id:i,loaded:!1};return t[i].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var o={};return e.m=t,e.c=o,e.p="",e(0)}([function(t,e){var o=function(t){var e={cockpitUrl:t.cockpitUrl,apiKey:t.apiKey,selector:t.selector,basePath:location.pathname.slice(0,-1),collections:{},regions:{},collectionsLoaded:!1,regionsLoaded:!1,imagePathsLoaded:!1,loaded:!1,thumbnailWidth:t.thumbnailWidth?t.thumbnailWidth:1920,thumbnailQuality:t.thumbnailQuality?t.thumbnailQuality:70,totalNumberOfImageFields:0,totalNumberOfImagePathRequests:0},o=document.cookie.length>0,i=window.location.search.indexOf("hint")>=0,n=i?"Hide hints":"Show hints";if(o&&$("body").append('<button id="toggleSegmentHints" class="" style="position: fixed; top: 0; right: 0; z-index: 999999; background-color: #555; color: #fff; cursor: pointer; border: 0; font-family: Sans-Serif; font-size: 14px; padding: 10px 15px;">'+n+"</button>"),$("#toggleSegmentHints").click(function(){var t=window.location.href.split("#")[0];i?window.location.href=t.replace("?hints",""):window.location.href=t+"?hints"}),i>0){var a=function(t,e,o,i){0==t.parents(".has-binding").length&&(t.css("outline","1px dashed red").css("cursor","pointer"),t.attr("entity-type",e),t.attr("entity-name",o),t.attr("title",e+" > "+o+(i&&i.indexOf(" ")==-1?" > "+i:"")),t.addClass("has-binding"))};$(':not(:has(div)):contains("{{")').each(function(){var t=$(this),e=t.text();if(e.indexOf("regions.")>0||e.indexOf("collections.")>0){var o=e.trim().replace("{{","").replace("}}","").split("."),i=o[0],n=o[1],c=o[2];a(t,i,n,c)}}),$("[v-for]").each(function(){var t=$(this),e=t.attr("v-for"),o=e.indexOf(" in ")>0?"in":"of",i=e.split(" "+o+" ")[1].split(".")[0],n=e.split(".")[1],c=e.split(".")[2];a(t,i,n,c)}),$("[v-html]").each(function(){var t=$(this),e=t.attr("v-html"),o=e.split("."),i=o[0],n=o[1],c=o[2];a(t,i,n,c)}),$("[v-bind\\:href]").each(function(){var t=$(this),e=t.attr("v-bind:href"),o=e.split("."),i="regions",n=o[1],c=o[2];a(t,i,n,c)}),$("[v-bind\\:src]").each(function(){var t=$(this),e=t.attr("v-bind:src"),o=e.split("."),i="regions",n=o[1],c=o[2];a(t,i,n,c)}),$("body").on("click",".has-binding",function(t){var o=$(this),i=o.attr("entity-type"),n=o.attr("entity-name"),a="regions"==i?"form":"entries",c=e.cockpitUrl+"/"+i+"/"+a+"/"+n;window.open(c)})}fetch(e.cockpitUrl+"/api/collections/listCollections?token="+e.apiKey).then(function(t){return t.json()}).then(function(o){e.collectionNames=o,o.forEach(function(t){e.collections[t]=[]}),fetch(e.cockpitUrl+"/api/regions/listRegions?token="+e.apiKey).then(function(t){return t.json()}).then(function(o){e.regionNames=o,o.forEach(function(t){e.regions[t]=[]}),new Vue({el:e.selector,data:e,created:function(){this.fetchAllCollectionEntries(),this.fetchAllRegionEntries()},methods:{fetchAllRegionEntries:function(){var t=this;this.regionNames.forEach(function(e,o,i){var n=o==i.length-1;t.fetchRegionEntries(e,n)})},fetchRegionEntries:function(o,i){var n=this;fetch(e.cockpitUrl+"/api/regions/data/"+o+"?token="+this.apiKey).then(function(t){return t.json()}).then(function(e){n.regions[o]=e,n.regionsLoaded=n.regionsLoaded||i,n.regionsLoaded&&n.collectionsLoaded&&t.callback&&t.callback()})["catch"](function(t){console.log("parsing failed",t)})},fetchAllCollectionEntries:function(){var t=this;this.collectionNames.forEach(function(e,o,i){var n=o==i.length-1;t.fetchCollectionEntries(e,n)})},fetchCollectionEntries:function(o,i){var n=this;fetch(e.cockpitUrl+"/api/collections/get/"+o+"?token="+this.apiKey).then(function(t){return t.json()}).then(function(a){var c=0;Object.keys(a.fields).forEach(function(t){"image"==a.fields[t].type&&(c+=1)}),n.totalNumberOfImageFields+=c*a.entries.length,i&&0==n.totalNumberOfImageFields&&(console.log("aha"),n.imagePathsLoaded=!0),a.entries.forEach(function(o){Object.keys(o).forEach(function(i){o[i].path&&fetch(e.cockpitUrl+"/api/cockpit/image?token="+n.apiKey,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({src:o[i].path,m:"resize",w:e.thumbnailWidth,q:e.thumbnailQuality})}).then(function(t){return t.text()}).then(function(e){o[i].thumbnailPath=e,n.totalNumberOfImagePathRequests+=1,console.log(n.totalNumberOfImageFields+":"+n.totalNumberOfImagePathRequests),n.imagePathsLoaded=n.totalNumberOfImageFields==n.totalNumberOfImagePathRequests,n.regionsLoaded&&n.collectionsLoaded&&n.imagePathsLoaded&&t.callback&&(n.loaded=!0,t.callback())})["catch"](function(e){n.totalNumberOfImagePathRequests+=1,n.imagePathsLoaded=n.totalNumberOfImageFields==n.totalNumberOfImagePathRequests,n.regionsLoaded&&n.collectionsLoaded&&n.imagePathsLoaded&&t.callback&&(n.loaded=!0,t.callback()),console.log("parsing failed",e)})})}),n.collections[o]=a.entries,n.collectionsLoaded=n.collectionsLoaded||i,n.regionsLoaded&&n.collectionsLoaded&&n.imagePathsLoaded&&t.callback&&(n.loaded=!0,t.callback())})["catch"](function(t){console.log("parsing failed",t)})}}})})})["catch"](function(t){console.log("parsing failed",t)})};t.exports={init:o}}])});
//# sourceMappingURL=vue-cockpit.min.js.map